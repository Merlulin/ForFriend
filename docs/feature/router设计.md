# 企业级 Router 设计方案（总结版）

## 个人分析
对于Router的设计，其实本质上就是要管理好页面的跳转和加载，以及一些通用性的预处理和验证操作。
故而通常会以index.ts作为router的核心，但是抽离出有关路由的配置为config.ts（比如是否启用动态路由，是否启用hash模式，是否启用三级路由缓存（降级）），此外最重要的就是guard.ts，这个文件用于统一管理路由相关的前置预处理，自动载入Title、权限拦截自动跳转等。然后所有一些辅助性的方法可以单独抽离成helper，而一些功能比较明显且通用的，可以独立抽离比如whitelist。

## 1. 设计目标
- 高可维护：职责清晰、可读性强、易迭代
- 高可扩展：支持动态路由、权限、菜单、缓存等需求
- 高可测试：算法与流程解耦，便于单测/集成测
- 多人协作友好：模块边界明确，避免冲突

## 2. 目录职责划分
### 2.1 配置项（config）
- 定义路由运行时的“基础策略”，如路由模式、动态路由开关、默认角色、三级缓存等。
- 特征：稳定、可复用、可配置。
- 企业价值：配置与逻辑分离，便于多环境部署、灰度与运维变更。

### 2.2 守卫（guard）
- 统一控制路由进入前/后的流程：登录校验、权限校验、动态路由注入、标题设置、进度条、埋点等。
- 企业价值：安全策略集中落地、流程一致、便于审计。

### 2.3 辅助函数（helper）
- 封装“可复用算法”，如扁平化路由、权限过滤、菜单生成等。
- 企业价值：降低守卫复杂度，提高可测试性。

### 2.4 白名单（whitelist）
- 明确“无需登录/无需权限”的访问边界。
- 企业价值：安全策略显式化，可审核、可追踪。

## 3. 动态路由的定义与价值
- 动态路由：运行时根据用户权限/后端菜单/租户配置注入的路由。
- 核心价值：权限隔离、菜单动态化、功能开关、按需展示。
- 典型流程：登录 → 拉取权限 → 生成路由 → 注入 router → 进入目标页。

## 4. meta 的角色定位
- meta 是“路由的业务配置容器”，不被路由器自动处理，但会被应用逻辑读取。
- 常见用途：
  - 权限控制：roles
  - 菜单展示：title、elIcon、svgIcon、hidden、alwaysShow
  - 页面行为：keepAlive、affix
  - 业务扩展：featureFlag、trackKey 等

## 5. 路由模式与部署路径
- Vue 3 使用 createWebHistory / createWebHashHistory。
- Hash 模式 URL 形如 /#/xxx，不依赖服务端配置。
- HTML5 模式 URL 形如 /xxx，需要服务器回退配置。
- VITE_PUBLIC_PATH：由 Vite 注入的环境变量，用于设置 router history 的 base，确保子路径部署正确。

## 6. NProgress 的企业级价值
- 作用：路由切换时提供加载反馈，提升感知体验。
- 放在守卫中可实现全局统一控制，避免页面各自处理导致体验不一致。

## 7. 初学者学习路线（建议）
1) 先理解 config 与 meta 的配置边界
2) 再理解 guard 中的流程控制（登录、权限、动态路由注入）
3) 学习 helper 的抽象与单测价值
4) 最后理解 whitelist 的安全边界

## 8. 设计口诀
- 配置 = 数据
- 守卫 = 流程
- 辅助 = 算法
- 白名单 = 边界

## 9. 参考实现（项目内）
- Router 配置与路由表：见 [src/router/index.ts](src/router/index.ts)
- 路由配置项：见 [src/router/config.ts](src/router/config.ts)
- 路由守卫：见 [src/router/guard.ts](src/router/guard.ts)
- 白名单：见 [src/router/whitelist.ts](src/router/whitelist.ts)
